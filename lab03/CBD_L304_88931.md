# Cassandra: Free-Themed Database

## Initial Idea
I choose to create a Cassandra Database to support a popular plataform, YELP, fulfilling the following requirements:
* User Managment (regular user `or` owner)
* Restaurant Managment
* Reviews Management
* Favorites Management


## Keyspace Creation
* `create keyspace yelp with replication = {'class': 'SimpleStrategy', 'replication_factor' : '1'};`

## DB Modelling

### Owners
```
    create table owner (
        username text primary key,
        fname text,
        lname text,
        email text,
        phone_number text,
        added_date timestamp
    );
```

### Users
```
    create table user (
        username text primary key,
        fname text,
        lname text,
        email text,
        phone_number text,
        favorites map<int, text>,
        added_date timestamp
    );
```

### Restaurants
```
    create table restaurant (
        id int primary key,
        owner text,
        name text,
        address text,
        city text,
        types_of_food set<text>,
        avg_rating float,
        comments map<text, text>,
        phone_number text,
        added_date timestamp,
    );
```

```
    create table restaurants_per_owner (
        id int,
        owner text,
        name text,
        address text,
        city text,
        types_of_food set<text>,
        avg_rating float,
        comments map<text, text>,
        phone_number text,
        added_date timestamp,
        primary key (owner, avg_rating)
    ) with clustering order by (avg_rating desc);
```

```
    create table restaurants_per_city (
        id int,
        owner text,
        name text,
        address text,
        city text,
        types_of_food set<text>,
        avg_rating float,
        comments list<text>,
        phone_number text,
        added_date timestamp,
        primary key (city, avg_rating)
    ) with clustering order by (avg_rating desc);
```

### Reviews
```
    create table reviews_per_rest (
        rest_id int,
        user text,
        title text,
        comment text,
        stars float,
        added_date timestamp,

        primary key (rest_id, added_date, user)
    ) with clustering order by (added_date desc, user asc);
```

### Types of Food
```
    create table type_foods (
        type_of_food text primary key,
        rests set<int>,
        n_of_rest int
    );
```


## Populate DB

### Insert Into `owner`
```
insert into owner (username, fname, lname, email, phone_number, added_date) values ('vascoalramos', 'Vasco', 'Ramos', 'vascoalramos@ua.pt', '123456789', '2019-12-01');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('joaovasconcelos', 'Joao', 'Vasconcelos', 'joaov@ua.pt', '123456789', '2019-12-02');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('ds', 'Diogo', 'Silva', 'ds@ua.pt', '123456789', '2019-12-03');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('escal', 'Pedro', 'Escaleira', 'oescal@ua.pt', '123456789', '2019-12-04');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('rafas', 'Rafael', 'Simoes', 'rs@ua.pt', '123456789', '2019-12-05');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('pedro', 'Pedro', 'Oliveira', 'pedro@ua.pt', '123456789', '2019-12-06');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('mota', 'Miguel', 'Mota', 'mota@ua.pt', '123456789', '2019-12-07');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('piscas', 'Luís', 'Fonseca', 'lsf@ua.pt', '123456789', '2019-12-08');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('mota2', 'Miguel', 'Mota', 'mota2@ua.pt', '123456789', '2019-12-09');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('dg', 'Diogo', 'Gomes', 'dg@ua.pt', '123456789', '2019-12-10');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('carina', 'Carina', 'Mota', 'carina@ua.pt', '123456789', '2019-12-10');
insert into owner (username, fname, lname, email, phone_number, added_date) values ('acores', 'André', 'Baião', 'baiao@ua.pt', '123456789', '2019-12-11');
``` 

### Insert Into `user`
```
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('jlo', 'José', 'Oliveira', 'jlo@ua.pt', '123456789', {1: 'Rest1', 2: 'Rest2', 3: 'Rest3', 12: 'Rest12', 10: 'Rest10'}, '2019-12-01');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('barraca', 'João', 'Barraca', 'barraca@ua.pt','123456789', {1: 'Rest1', 8: 'Rest8', 4: 'Rest4'}, '2019-12-02');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('lsl', 'Luís', 'S. Lopes', 'lsl@ua.pt', '123456789', {4: 'Rest4'}, '2019-12-03');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('cc', 'Carlos', 'Costa', 'cc@ua.pt', '123456789', {12: 'Rest12', 5: 'Rest5', 4: 'Rest4', 9: 'Rest9', 10: 'Rest10'}, '2019-12-04');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('neves', 'António', 'Neves', 'an@ua.pt', '123456789', {1: 'Rest1', 2: 'Rest2',6: 'Rest6', 3: 'Rest3', 9: 'Rest9', 7: 'Rest7', 12: 'Rest12'}, '2019-12-05');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('nogueira', 'António', 'Nogueira', 'nogueira@ua.pt', '123456789', {}, '2019-12-06');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('tos', 'Tomás', 'O. Silva', 'tos@ua.pt', '123456789', {}, '2019-12-07');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('mos', 'Miguel', 'O. Silva', 'mos@ua.pt', '123456789', {}, '2019-12-08');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('mantunes', 'Mário', 'Antunes', 'mantunes@ua.pt', '123456789', {2: 'Rest2', 6: 'Rest6'}, '2019-12-09');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('maria', 'José', 'Maria', 'maria@ua.pt', '123456789', {9: 'Rest9'}, '2019-12-10');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('ico', 'Ilidio', 'Oliveira', 'ico@ua.pt', '123456789', {1: 'Rest1'}, '2019-12-10');
insert into user (username, fname, lname, email, phone_number, favorites, added_date) values ('jsp', 'Joaquim', 'S. Pinto', 'jsp@ua.pt', '123456789', {8: 'Rest8'}, '2019-12-11');
```

### Insert into `restaurant`
```
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (1, 'escal', 'Rest1', 'Addr1', 'Viseu', {'portuguese'}, 3.4, {'lsl': 'Awesome food, great space! Awesome experience!'}, '123456789', '2019-12-01');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (2, 'escal', 'Rest2', 'Addr2', 'Coimbra', {'portuguese', 'american', 'italian'}, 4.1, {'jlo': ' Good food, good service and great space!'}, '123456789', '2019-12-02');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (3, 'ds', 'Rest3', 'Addr3', 'Lisboa', {'american', 'chinese'}, 1.8, {'ico': 'Average food...'}, '123456789', '2019-12-03');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (4, 'escal', 'Rest4', 'Addr4', 'Coimbra', {'italian'}, 4.8, {}, '123456789', '2019-12-04');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (5, 'escal', 'Rest5', 'Addr5', 'Coimbra', {'french', 'portuguese'}, 2.5, {}, '123456789', '2019-12-05');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (6, 'vascoalramos', 'Rest6', 'Addr6', 'Coimbra', {'italian', 'portuguese'}, 3.9, {'cc': 'What a great experience!', 'ico': 'Nice food!', 'lsl': 'Nice food!'}, '123456789', '2019-12-06');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (7, 'joaovasconcelos', 'Rest7', 'Addr7', 'Coimbra', {'italian', 'portuguese', 'french'}, 2.1, {}, '123456789', '2019-12-07');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (8, 'vascoalramos', 'Rest8', 'Addr8', 'Braga', {'american', 'portuguese', 'french'}, 3.0, {'jsp': 'Awful!'}, '123456789', '2019-12-08');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (9, 'vascoalramos', 'Rest9', 'Addr9', 'Coimbra', {'portuguese'}, 4.1, {}, '123456789', '2019-12-09');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (10, 'ds', 'Rest10', 'Addr10', 'Viseu', {'chinese'}, 2.7, {}, '123456789', '2019-12-10');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (11, 'joaovasconcelos', 'Rest11', 'Addr11', 'Braga', {'portuguese'}, 4.7, {'nogueira': 'Awesome food, great space! Awesome experience!', 'mos': 'Food has good quantity, but very average quality', 'lsl': 'Awesome food, great space! Awesome experience!', 'jlo': 'Good food, good service and great space!'}, '123456789', '2019-12-11');
insert into restaurant (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (12, 'vascoalramos', 'Rest12', 'Addr12', 'Braga', {'portuguese'}, 4.0, {'ico': 'Bad food, expensive prices'}, '123456789', '2019-12-12');
```

### Insert into `restaurants_per_owner`
```
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (1, 'escal', 'Rest1', 'Addr1', 'Viseu', {'portuguese'}, 3.4, {'lsl': 'Awesome food, great space! Awesome experience!'}, '123456789', '2019-12-01');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (2, 'escal', 'Rest2', 'Addr2', 'Coimbra', {'portuguese', 'american', 'italian'}, 4.1, {'jlo': ' Good food, good service and great space!'}, '123456789', '2019-12-02');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (3, 'ds', 'Rest3', 'Addr3', 'Lisboa', {'american', 'chinese'}, 1.8, {'ico': 'Average food...'}, '123456789', '2019-12-03');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (4, 'escal', 'Rest4', 'Addr4', 'Coimbra', {'italian'}, 4.8, {}, '123456789', '2019-12-04');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (5, 'escal', 'Rest5', 'Addr5', 'Coimbra', {'french', 'portuguese'}, 2.5, {}, '123456789', '2019-12-05');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (6, 'vascoalramos', 'Rest6', 'Addr6', 'Coimbra', {'italian', 'portuguese'}, 3.9, {'cc': 'What a great experience!', 'ico': 'Nice food!', 'lsl': 'Nice food!'}, '123456789', '2019-12-06');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (7, 'joaovasconcelos', 'Rest7', 'Addr7', 'Coimbra', {'italian', 'portuguese', 'french'}, 2.1, {}, '123456789', '2019-12-07');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (8, 'vascoalramos', 'Rest8', 'Addr8', 'Braga', {'american', 'portuguese', 'french'}, 3.0, {'jsp': 'Awful!'}, '123456789', '2019-12-08');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (9, 'vascoalramos', 'Rest9', 'Addr9', 'Coimbra', {'portuguese'}, 4.1, {}, '123456789', '2019-12-09');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (10, 'ds', 'Rest10', 'Addr10', 'Viseu', {'chinese'}, 2.7, {}, '123456789', '2019-12-10');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (11, 'joaovasconcelos', 'Rest11', 'Addr11', 'Braga', {'portuguese'}, 4.7, {'nogueira': 'Awesome food, great space! Awesome experience!', 'mos': 'Food has good quantity, but very average quality', 'lsl': 'Awesome food, great space! Awesome experience!', 'jlo': 'Good food, good service and great space!'}, '123456789', '2019-12-11');
insert into restaurants_per_owner (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (12, 'vascoalramos', 'Rest12', 'Addr12', 'Braga', {'portuguese'}, 4.0, {'ico': 'Bad food, expensive prices'}, '123456789', '2019-12-12');
```

### Insert into `restaurants_per_city`
```
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (1, 'escal', 'Rest1', 'Addr1', 'Viseu', {'portuguese'}, 3.4, ['Awesome food, great space! Awesome experience!'], '123456789', '2019-12-01');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (2, 'escal', 'Rest2', 'Addr2', 'Coimbra', {'portuguese', 'american', 'italian'}, 4.1, [' Good food, good service and great space!'], '123456789', '2019-12-02');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (3, 'ds', 'Rest3', 'Addr3', 'Lisboa', {'american', 'chinese'}, 1.8, ['Average food...'], '123456789', '2019-12-03');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (4, 'escal', 'Rest4', 'Addr4', 'Coimbra', {'italian'}, 4.8, [], '123456789', '2019-12-04');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (5, 'escal', 'Rest5', 'Addr5', 'Coimbra', {'french', 'portuguese'}, 2.5, [], '123456789', '2019-12-05');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (6, 'vascoalramos', 'Rest6', 'Addr6', 'Coimbra', {'italian', 'portuguese'}, 3.9, ['What a great experience!', 'Nice food!', 'Nice food!'], '123456789', '2019-12-06');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (7, 'joaovasconcelos', 'Rest7', 'Addr7', 'Coimbra', {'italian', 'portuguese', 'french'}, 2.1, [], '123456789', '2019-12-07');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (8, 'vascoalramos', 'Rest8', 'Addr8', 'Braga', {'american', 'portuguese', 'french'}, 3.0, ['Awful!'], '123456789', '2019-12-08');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (9, 'vascoalramos', 'Rest9', 'Addr9', 'Coimbra', {'portuguese'}, 4.0, [], '123456789', '2019-12-09');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (10, 'ds', 'Rest10', 'Addr10', 'Viseu', {'chinese'}, 2.7, [], '123456789', '2019-12-10');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (11, 'joaovasconcelos', 'Rest11', 'Addr11', 'Braga', {'portuguese'}, 4.7, ['Awesome food, great space! Awesome experience!', 'Food has good quantity, but very average quality', 'Awesome food, great space! Awesome experience!', 'Good food, good service and great space!'], '123456789', '2019-12-11');
insert into restaurants_per_city (id, owner, name, address, city, types_of_food, avg_rating, comments, phone_number, added_date) values (12, 'vascoalramos', 'Rest12', 'Addr12', 'Braga', {'portuguese'}, 4.0, ['Bad food, expensive prices'], '123456789', '2019-12-12');
```

### Insert into `reviews_per_rest`
```
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (11, 'mos', 'Just average...', 'Food has good quantity, but very average quality', 3.0, '2019-12-01');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (11, 'nogueira', 'Really Good!', 'Awesome food, great space! Awesome experience!', 5.0, '2019-12-01');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (11, 'jlo', 'Quite nice!', 'Good food, good service and great space!', 4.5, '2019-12-01');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (11, 'lsl', 'Nice!', 'Awesome food, great space! Awesome experience!', 2.0, '2019-12-01');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (1, 'lsl', 'Nice!', 'Awesome food, great space! Awesome experience!', 3.0, '2019-12-19');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (2, 'jlo', 'Quite nice!', 'Good food, good service and great space!', 4.2, '2019-12-10');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (12, 'ico', 'Really bad!', 'Bad food, expensive prices', 1.0, '2019-12-10');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (11, 'ico', 'Really bad!', 'Bad food, expensive prices', 1.0, '2019-12-10');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (3, 'ico', 'Average!', 'Average food...', 2.5, '2019-12-12');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (6, 'lsl', 'Nice!', 'Nice food!', 3.6, '2019-11-6');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (6, 'ico', 'Awesome!', 'Nice food!', 4, '2019-11-6');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (6, 'cc', 'Great food!', 'What a great experience!', 4.7, '2019-11-6');
insert into reviews_per_rest (rest_id, user, title, comment, stars, added_date) values (8, 'jsp', 'Bad experience!', 'Awful!', 1.0, '2019-11-12');
```

### Insert into `type_foods`
```
insert into type_foods (type_of_food, rests, n_of_rest) values ('french', {5, 8, 7}, 3);
insert into type_foods (type_of_food, rests, n_of_rest) values ('portuguese', {5, 11, 1, 8, 2, 7, 6, 9, 12}, 9);
insert into type_foods (type_of_food, rests, n_of_rest) values ('chinese', {10, 3}, 2);
insert into type_foods (type_of_food, rests, n_of_rest) values ('american', {8, 2, 3}, 3);
insert into type_foods (type_of_food, rests, n_of_rest) values ('italian', {2, 4, 7, 6}, 4);
```


## Queries

### 1. All the restaurants of an owner ordered by timestamp (latest to oldest)
```
cqlsh:yelp> select * from restaurants_per_owner where owner = 'escal';

 owner | avg_rating | added_date                      | address | city    | comments                                                  | id | name  | phone_number | types_of_food
-------+------------+---------------------------------+---------+---------+-----------------------------------------------------------+----+-------+--------------+---------------------------------------
 escal |        4.8 | 2019-12-04 00:00:00.000000+0000 |   Addr4 | Coimbra |                                                      null |  4 | Rest4 |    123456789 |                           {'italian'}
 escal |        4.1 | 2019-12-02 00:00:00.000000+0000 |   Addr2 | Coimbra |      {'jlo': ' Good food, good service and great space!'} |  2 | Rest2 |    123456789 | {'american', 'italian', 'portuguese'}
 escal |        3.4 | 2019-12-01 00:00:00.000000+0000 |   Addr1 |   Viseu | {'lsl': 'Awesome food, great space! Awesome experience!'} |  1 | Rest1 |    123456789 |                        {'portuguese'}
 escal |        2.5 | 2019-12-05 00:00:00.000000+0000 |   Addr5 | Coimbra |                                                      null |  5 | Rest5 |    123456789 |              {'french', 'portuguese'}

(4 rows)
```

### 2. All the favorites of each user
```
cqlsh:yelp> select favorites from user;

 favorites
----------------------------------------------------------------------------------------
                                                                                   null
                                                                                   null
                                                                           {9: 'Rest9'}
                       {1: 'Rest1', 2: 'Rest2', 3: 'Rest3', 10: 'Rest10', 12: 'Rest12'}
                                                                                   null
                                                   {1: 'Rest1', 4: 'Rest4', 8: 'Rest8'}
                       {4: 'Rest4', 5: 'Rest5', 9: 'Rest9', 10: 'Rest10', 12: 'Rest12'}
                                                                           {4: 'Rest4'}
                                                               {2: 'Rest2', 6: 'Rest6'}
                                                                           {8: 'Rest8'}
                                                                           {1: 'Rest1'}
 {1: 'Rest1', 2: 'Rest2', 3: 'Rest3', 6: 'Rest6', 7: 'Rest7', 9: 'Rest9', 12: 'Rest12'}

(12 rows)
```

### 3. All the types of food of a certain restaurant
```
cqlsh:yelp> select types_of_food from restaurant where id = 2;

 types_of_food
---------------------------------------
 {'american', 'italian', 'portuguese'}

(1 rows)
```

### 4. All the reviews of a restaurant ordered by timestamp (latest to oldest)
```
cqlsh:yelp> select * from reviews_per_rest where rest_id = 11;

 rest_id | added_date                      | user     | comment                                          | stars | title
---------+---------------------------------+----------+--------------------------------------------------+-------+-----------------
      11 | 2019-12-10 00:00:00.000000+0000 |      ico |                       Bad food, expensive prices |     1 |     Really bad!
      11 | 2019-12-01 00:00:00.000000+0000 |      jlo |         Good food, good service and great space! |   4.5 |     Quite nice!
      11 | 2019-12-01 00:00:00.000000+0000 |      lsl |   Awesome food, great space! Awesome experience! |     2 |           Nice!
      11 | 2019-12-01 00:00:00.000000+0000 |      mos | Food has good quantity, but very average quality |     3 | Just average...
      11 | 2019-12-01 00:00:00.000000+0000 | nogueira |   Awesome food, great space! Awesome experience! |     5 |    Really Good!

(5 rows)
```

### 5. All the restaurants in a certain city
```
cqlsh:yelp> select * from restaurants_per_city where city = 'Coimbra';

 city    | avg_rating | added_date                      | address | comments                                                 | id | name  | owner           | phone_number | types_of_food
---------+------------+---------------------------------+---------+----------------------------------------------------------+----+-------+-----------------+--------------+---------------------------------------
 Coimbra |        4.8 | 2019-12-04 00:00:00.000000+0000 |   Addr4 |                                                     null |  4 | Rest4 |           escal |    123456789 |                           {'italian'}
 Coimbra |        4.1 | 2019-12-02 00:00:00.000000+0000 |   Addr2 |            [' Good food, good service and great space!'] |  2 | Rest2 |           escal |    123456789 | {'american', 'italian', 'portuguese'}
 Coimbra |          4 | 2019-12-09 00:00:00.000000+0000 |   Addr9 |                                                     null |  9 | Rest9 |    vascoalramos |    123456789 |                        {'portuguese'}
 Coimbra |        3.9 | 2019-12-06 00:00:00.000000+0000 |   Addr6 | ['What a great experience!', 'Nice food!', 'Nice food!'] |  6 | Rest6 |    vascoalramos |    123456789 |             {'italian', 'portuguese'}
 Coimbra |        2.5 | 2019-12-05 00:00:00.000000+0000 |   Addr5 |                                                     null |  5 | Rest5 |           escal |    123456789 |              {'french', 'portuguese'}
 Coimbra |        2.1 | 2019-12-07 00:00:00.000000+0000 |   Addr7 |                                                     null |  7 | Rest7 | joaovasconcelos |    123456789 |   {'french', 'italian', 'portuguese'}

(6 rows)
```

### 6. List existing types of food and number of restaurants with each type
```
cqlsh:yelp> select * from type_foods ;

 type_of_food | n_of_rest | rests
--------------+-----------+-------------------------------
     american |         3 |                     {2, 3, 8}
       french |         3 |                     {5, 7, 8}
      italian |         4 |                  {2, 4, 6, 7}
      chinese |         2 |                       {3, 10}
   portuguese |         9 | {1, 2, 5, 6, 7, 8, 9, 11, 12}

(5 rows)
```

### 7. The last 3 reviews of a restaurant
```
cqlsh:yelp> select * from reviews_per_rest where rest_id = 11 limit 3;

 rest_id | added_date                      | user | comment                                        | stars | title
---------+---------------------------------+------+------------------------------------------------+-------+-------------
      11 | 2019-12-10 00:00:00.000000+0000 |  ico |                     Bad food, expensive prices |     1 | Really bad!
      11 | 2019-12-01 00:00:00.000000+0000 |  jlo |       Good food, good service and great space! |   4.5 | Quite nice!
      11 | 2019-12-01 00:00:00.000000+0000 |  lsl | Awesome food, great space! Awesome experience! |     2 |       Nice!

(3 rows)
```

### 8. The top 5 restaurants in a city (in reviews)
```
cqlsh:yelp> select * from restaurants_per_city where city = 'Coimbra' limit 5;

 city    | avg_rating | added_date                      | address | comments                                                 | id | name  | owner        | phone_number | types_of_food
---------+------------+---------------------------------+---------+----------------------------------------------------------+----+-------+--------------+--------------+---------------------------------------
 Coimbra |        4.8 | 2019-12-04 00:00:00.000000+0000 |   Addr4 |                                                     null |  4 | Rest4 |        escal |    123456789 |                           {'italian'}
 Coimbra |        4.1 | 2019-12-02 00:00:00.000000+0000 |   Addr2 |            [' Good food, good service and great space!'] |  2 | Rest2 |        escal |    123456789 | {'american', 'italian', 'portuguese'}
 Coimbra |          4 | 2019-12-09 00:00:00.000000+0000 |   Addr9 |                                                     null |  9 | Rest9 | vascoalramos |    123456789 |                        {'portuguese'}
 Coimbra |        3.9 | 2019-12-06 00:00:00.000000+0000 |   Addr6 | ['What a great experience!', 'Nice food!', 'Nice food!'] |  6 | Rest6 | vascoalramos |    123456789 |             {'italian', 'portuguese'}
 Coimbra |        2.5 | 2019-12-05 00:00:00.000000+0000 |   Addr5 |                                                     null |  5 | Rest5 |        escal |    123456789 |              {'french', 'portuguese'}

(5 rows)
```

### 9. The top 3 restaurants of an owner ordered by avg_rating (asc)
```
cqlsh:yelp> select * from restaurants_per_owner where owner = 'escal' order by avg_rating limit 3;

 owner | avg_rating | added_date                      | address | city    | comments                                                  | id | name  | phone_number | types_of_food
-------+------------+---------------------------------+---------+---------+-----------------------------------------------------------+----+-------+--------------+---------------------------------------
 escal |        2.5 | 2019-12-05 00:00:00.000000+0000 |   Addr5 | Coimbra |                                                      null |  5 | Rest5 |    123456789 |              {'french', 'portuguese'}
 escal |        3.4 | 2019-12-01 00:00:00.000000+0000 |   Addr1 |   Viseu | {'lsl': 'Awesome food, great space! Awesome experience!'} |  1 | Rest1 |    123456789 |                        {'portuguese'}
 escal |        4.1 | 2019-12-02 00:00:00.000000+0000 |   Addr2 | Coimbra |      {'jlo': ' Good food, good service and great space!'} |  2 | Rest2 |    123456789 | {'american', 'italian', 'portuguese'}

(3 rows)
```

### 10. All the reviews of a restaurant on a specific date
```
cqlsh:yelp> select * from reviews_per_rest where rest_id = 11 and added_date = '2019-12-01';

 rest_id | added_date                      | user     | comment                                          | stars | title
---------+---------------------------------+----------+--------------------------------------------------+-------+-----------------
      11 | 2019-12-01 00:00:00.000000+0000 |      jlo |         Good food, good service and great space! |   4.5 |     Quite nice!
      11 | 2019-12-01 00:00:00.000000+0000 |      lsl |   Awesome food, great space! Awesome experience! |     2 |           Nice!
      11 | 2019-12-01 00:00:00.000000+0000 |      mos | Food has good quantity, but very average quality |     3 | Just average...
      11 | 2019-12-01 00:00:00.000000+0000 | nogueira |   Awesome food, great space! Awesome experience! |     5 |    Really Good!

(4 rows)
```


## Updates and Deletes

### Delete an Owner
* `delete from owner where username = 'ds';`

* Result after update:
```
 username        | added_date                      | email              | fname  | lname       | phone_number
-----------------+---------------------------------+--------------------+--------+-------------+--------------
           escal | 2019-12-04 00:00:00.000000+0000 |       oescal@ua.pt |  Pedro |   Escaleira |    123456789
              dg | 2019-12-10 00:00:00.000000+0000 |           dg@ua.pt |  Diogo |       Gomes |    123456789
          acores | 2019-12-11 00:00:00.000000+0000 |        baiao@ua.pt |  André |       Baião |    123456789
           pedro | 2019-12-06 00:00:00.000000+0000 |        pedro@ua.pt |  Pedro |    Oliveira |    123456789
           rafas | 2019-12-05 00:00:00.000000+0000 |           rs@ua.pt | Rafael |      Simoes |    123456789
    vascoalramos | 2019-12-01 00:00:00.000000+0000 | vascoalramos@ua.pt |  Vasco |       Ramos |    123456789
            mota | 2019-12-07 00:00:00.000000+0000 |         mota@ua.pt | Miguel |        Mota |    123456789
          carina | 2019-12-10 00:00:00.000000+0000 |       carina@ua.pt | Carina |        Mota |    123456789
 joaovasconcelos | 2019-12-02 00:00:00.000000+0000 |        joaov@ua.pt |   Joao | Vasconcelos |    123456789
          piscas | 2019-12-08 00:00:00.000000+0000 |          lsf@ua.pt |   Luís |     Fonseca |    123456789
           mota2 | 2019-12-09 00:00:00.000000+0000 |        mota2@ua.pt | Miguel |        Mota |    123456789

(11 rows)
```

Now, we will propagate this delete to restaurant tables and the delete of restaurants will be propagated to the favorite sin user, the table reviews and type_foods

### Delete rests of owner
```
cqlsh:yelp> delete from restaurant where id = 10;
cqlsh:yelp> delete from restaurant where id = 3;
cqlsh:yelp> select * from restaurant;

 id | added_date                      | address | avg_rating | city    | comments                                                                                                                                                                                                                              | name   | owner           | phone_number | types_of_food
----+---------------------------------+---------+------------+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------+-----------------+--------------+---------------------------------------
  5 | 2019-12-05 00:00:00.000000+0000 |   Addr5 |        2.5 | Coimbra |                                                                                                                                                                                                                                  null |  Rest5 |           escal |    123456789 |              {'french', 'portuguese'}
 11 | 2019-12-11 00:00:00.000000+0000 |  Addr11 |        4.7 |   Braga | {'jlo': 'Good food, good service and great space!', 'lsl': 'Awesome food, great space! Awesome experience!', 'mos': 'Food has good quantity, but very average quality', 'nogueira': 'Awesome food, great space! Awesome experience!'} | Rest11 | joaovasconcelos |    123456789 |                        {'portuguese'}
  1 | 2019-12-01 00:00:00.000000+0000 |   Addr1 |        3.4 |   Viseu |                                                                                                                                                                             {'lsl': 'Awesome food, great space! Awesome experience!'} |  Rest1 |           escal |    123456789 |                        {'portuguese'}
  8 | 2019-12-08 00:00:00.000000+0000 |   Addr8 |          3 |   Braga |                                                                                                                                                                                                                     {'jsp': 'Awful!'} |  Rest8 |    vascoalramos |    123456789 |  {'american', 'french', 'portuguese'}
  2 | 2019-12-02 00:00:00.000000+0000 |   Addr2 |        4.1 | Coimbra |                                                                                                                                                                                  {'jlo': ' Good food, good service and great space!'} |  Rest2 |           escal |    123456789 | {'american', 'italian', 'portuguese'}
  4 | 2019-12-04 00:00:00.000000+0000 |   Addr4 |        4.8 | Coimbra |                                                                                                                                                                                                                                  null |  Rest4 |           escal |    123456789 |                           {'italian'}
  7 | 2019-12-07 00:00:00.000000+0000 |   Addr7 |        2.1 | Coimbra |                                                                                                                                                                                                                                  null |  Rest7 | joaovasconcelos |    123456789 |   {'french', 'italian', 'portuguese'}
  6 | 2019-12-06 00:00:00.000000+0000 |   Addr6 |        3.9 | Coimbra |                                                                                                                                                          {'cc': 'What a great experience!', 'ico': 'Nice food!', 'lsl': 'Nice food!'} |  Rest6 |    vascoalramos |    123456789 |             {'italian', 'portuguese'}
  9 | 2019-12-09 00:00:00.000000+0000 |   Addr9 |        4.1 | Coimbra |                                                                                                                                                                                                                                  null |  Rest9 |    vascoalramos |    123456789 |                        {'portuguese'}
 12 | 2019-12-12 00:00:00.000000+0000 |  Addr12 |          4 |   Braga |                                                                                                                                                                                                 {'ico': 'Bad food, expensive prices'} | Rest12 |    vascoalramos |    123456789 |                        {'portuguese'}

(10 rows)
```

```
cqlsh:yelp> delete from restaurants_per_owner where owner = 'ds';
cqlsh:yelp> select * from restaurants_per_owner ;

 owner           | avg_rating | added_date                      | address | city    | comments                                                                                                                                                                                                                              | id | name   | phone_number | types_of_food
-----------------+------------+---------------------------------+---------+---------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----+--------+--------------+---------------------------------------
           escal |        4.8 | 2019-12-04 00:00:00.000000+0000 |   Addr4 | Coimbra |                                                                                                                                                                                                                                  null |  4 |  Rest4 |    123456789 |                           {'italian'}
           escal |        4.1 | 2019-12-02 00:00:00.000000+0000 |   Addr2 | Coimbra |                                                                                                                                                                                  {'jlo': ' Good food, good service and great space!'} |  2 |  Rest2 |    123456789 | {'american', 'italian', 'portuguese'}
           escal |        3.4 | 2019-12-01 00:00:00.000000+0000 |   Addr1 |   Viseu |                                                                                                                                                                             {'lsl': 'Awesome food, great space! Awesome experience!'} |  1 |  Rest1 |    123456789 |                        {'portuguese'}
           escal |        2.5 | 2019-12-05 00:00:00.000000+0000 |   Addr5 | Coimbra |                                                                                                                                                                                                                                  null |  5 |  Rest5 |    123456789 |              {'french', 'portuguese'}
    vascoalramos |        4.1 | 2019-12-09 00:00:00.000000+0000 |   Addr9 | Coimbra |                                                                                                                                                                                                                                  null |  9 |  Rest9 |    123456789 |                        {'portuguese'}
    vascoalramos |          4 | 2019-12-12 00:00:00.000000+0000 |  Addr12 |   Braga |                                                                                                                                                                                                 {'ico': 'Bad food, expensive prices'} | 12 | Rest12 |    123456789 |                        {'portuguese'}
    vascoalramos |        3.9 | 2019-12-06 00:00:00.000000+0000 |   Addr6 | Coimbra |                                                                                                                                                          {'cc': 'What a great experience!', 'ico': 'Nice food!', 'lsl': 'Nice food!'} |  6 |  Rest6 |    123456789 |             {'italian', 'portuguese'}
    vascoalramos |          3 | 2019-12-08 00:00:00.000000+0000 |   Addr8 |   Braga |                                                                                                                                                                                                                     {'jsp': 'Awful!'} |  8 |  Rest8 |    123456789 |  {'american', 'french', 'portuguese'}
 joaovasconcelos |        4.7 | 2019-12-11 00:00:00.000000+0000 |  Addr11 |   Braga | {'jlo': 'Good food, good service and great space!', 'lsl': 'Awesome food, great space! Awesome experience!', 'mos': 'Food has good quantity, but very average quality', 'nogueira': 'Awesome food, great space! Awesome experience!'} | 11 | Rest11 |    123456789 |                        {'portuguese'}
 joaovasconcelos |        2.1 | 2019-12-07 00:00:00.000000+0000 |   Addr7 | Coimbra |                                                                                                                                                                                                                                  null |  7 |  Rest7 |    123456789 |   {'french', 'italian', 'portuguese'}

(10 rows)
```

```
cqlsh:yelp> delete from restaurants_per_city where city = 'Lisboa' and avg_rating = 1.8;
cqlsh:yelp> delete from restaurants_per_city where city = 'Viseu' and avg_rating = 2.7;
cqlsh:yelp> select * from restaurants_per_city ;

 city    | avg_rating | added_date                      | address | comments                                                                                                                                                                                             | id | name   | owner           | phone_number | types_of_food
---------+------------+---------------------------------+---------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----+--------+-----------------+--------------+---------------------------------------
 Coimbra |        4.8 | 2019-12-04 00:00:00.000000+0000 |   Addr4 |                                                                                                                                                                                                 null |  4 |  Rest4 |           escal |    123456789 |                           {'italian'}
 Coimbra |        4.1 | 2019-12-02 00:00:00.000000+0000 |   Addr2 |                                                                                                                                                        [' Good food, good service and great space!'] |  2 |  Rest2 |           escal |    123456789 | {'american', 'italian', 'portuguese'}
 Coimbra |          4 | 2019-12-09 00:00:00.000000+0000 |   Addr9 |                                                                                                                                                                                                 null |  9 |  Rest9 |    vascoalramos |    123456789 |                        {'portuguese'}
 Coimbra |        3.9 | 2019-12-06 00:00:00.000000+0000 |   Addr6 |                                                                                                                                             ['What a great experience!', 'Nice food!', 'Nice food!'] |  6 |  Rest6 |    vascoalramos |    123456789 |             {'italian', 'portuguese'}
 Coimbra |        2.5 | 2019-12-05 00:00:00.000000+0000 |   Addr5 |                                                                                                                                                                                                 null |  5 |  Rest5 |           escal |    123456789 |              {'french', 'portuguese'}
 Coimbra |        2.1 | 2019-12-07 00:00:00.000000+0000 |   Addr7 |                                                                                                                                                                                                 null |  7 |  Rest7 | joaovasconcelos |    123456789 |   {'french', 'italian', 'portuguese'}
   Viseu |        3.4 | 2019-12-01 00:00:00.000000+0000 |   Addr1 |                                                                                                                                                   ['Awesome food, great space! Awesome experience!'] |  1 |  Rest1 |           escal |    123456789 |                        {'portuguese'}
   Braga |        4.7 | 2019-12-11 00:00:00.000000+0000 |  Addr11 | ['Awesome food, great space! Awesome experience!', 'Food has good quantity, but very average quality', 'Awesome food, great space! Awesome experience!', 'Good food, good service and great space!'] | 11 | Rest11 | joaovasconcelos |    123456789 |                        {'portuguese'}
   Braga |          4 | 2019-12-12 00:00:00.000000+0000 |  Addr12 |                                                                                                                                                                       ['Bad food, expensive prices'] | 12 | Rest12 |    vascoalramos |    123456789 |                        {'portuguese'}
   Braga |          3 | 2019-12-08 00:00:00.000000+0000 |   Addr8 |                                                                                                                                                                                           ['Awful!'] |  8 |  Rest8 |    vascoalramos |    123456789 |  {'american', 'french', 'portuguese'}

(10 rows)
cqlsh:yelp>
```

```
cqlsh:yelp> delete from reviews_per_rest where rest_id = 10;
cqlsh:yelp> delete from reviews_per_rest where rest_id = 3;
cqlsh:yelp> select * from reviews_per_rest ;

 rest_id | added_date                      | user     | comment                                          | stars | title
---------+---------------------------------+----------+--------------------------------------------------+-------+-----------------
      11 | 2019-12-10 00:00:00.000000+0000 |      ico |                       Bad food, expensive prices |     1 |     Really bad!
      11 | 2019-12-01 00:00:00.000000+0000 |      jlo |         Good food, good service and great space! |   4.5 |     Quite nice!
      11 | 2019-12-01 00:00:00.000000+0000 |      lsl |   Awesome food, great space! Awesome experience! |     2 |           Nice!
      11 | 2019-12-01 00:00:00.000000+0000 |      mos | Food has good quantity, but very average quality |     3 | Just average...
      11 | 2019-12-01 00:00:00.000000+0000 | nogueira |   Awesome food, great space! Awesome experience! |     5 |    Really Good!
       1 | 2019-12-19 00:00:00.000000+0000 |      lsl |   Awesome food, great space! Awesome experience! |     3 |           Nice!
       8 | 2019-11-12 00:00:00.000000+0000 |      jsp |                                           Awful! |     1 | Bad experience!
       2 | 2019-12-10 00:00:00.000000+0000 |      jlo |         Good food, good service and great space! |   4.2 |     Quite nice!
       6 | 2019-11-06 00:00:00.000000+0000 |       cc |                         What a great experience! |   4.7 |     Great food!
       6 | 2019-11-06 00:00:00.000000+0000 |      ico |                                       Nice food! |     4 |        Awesome!
       6 | 2019-11-06 00:00:00.000000+0000 |      lsl |                                       Nice food! |   3.6 |           Nice!
      12 | 2019-12-10 00:00:00.000000+0000 |      ico |                       Bad food, expensive prices |     1 |     Really bad!

(12 rows)
```

```
cqlsh:yelp> update user set favorites = {1: 'Rest1', 2: 'Rest2', 12: 'Rest12'} where username = 'jlo';
cqlsh:yelp> update user set favorites = {4: 'Rest4', 5: 'Rest5', 9: 'Rest9', 12: 'Rest12'} where username = 'cc';
cqlsh:yelp> update user set favorites = {1: 'Rest1', 2: 'Rest2', 6: 'Rest6', 7: 'Rest7', 9: 'Rest9', 12: 'Rest12'} where username = 'neves';
cqlsh:yelp> select * from user;

 username | added_date                      | email          | favorites                                                                  | fname   | lname    | phone_number
----------+---------------------------------+----------------+----------------------------------------------------------------------------+---------+----------+--------------
      mos | 2019-12-08 00:00:00.000000+0000 |      mos@ua.pt |                                                                       null |  Miguel | O. Silva |    123456789
 nogueira | 2019-12-06 00:00:00.000000+0000 | nogueira@ua.pt |                                                                       null | António | Nogueira |    123456789
    maria | 2019-12-10 00:00:00.000000+0000 |    maria@ua.pt |                                                               {9: 'Rest9'} |    José |    Maria |    123456789
      jlo | 2019-12-01 00:00:00.000000+0000 |      jlo@ua.pt |                                     {1: 'Rest1', 2: 'Rest2', 12: 'Rest12'} |    José | Oliveira |    123456789
      tos | 2019-12-07 00:00:00.000000+0000 |      tos@ua.pt |                                                                       null |   Tomás | O. Silva |    123456789
  barraca | 2019-12-02 00:00:00.000000+0000 |  barraca@ua.pt |                                       {1: 'Rest1', 4: 'Rest4', 8: 'Rest8'} |    João |  Barraca |    123456789
       cc | 2019-12-04 00:00:00.000000+0000 |       cc@ua.pt |                         {4: 'Rest4', 5: 'Rest5', 9: 'Rest9', 12: 'Rest12'} |  Carlos |    Costa |    123456789
      lsl | 2019-12-03 00:00:00.000000+0000 |      lsl@ua.pt |                                                               {4: 'Rest4'} |    Luís | S. Lopes |    123456789
 mantunes | 2019-12-09 00:00:00.000000+0000 | mantunes@ua.pt |                                                   {2: 'Rest2', 6: 'Rest6'} |   Mário |  Antunes |    123456789
      jsp | 2019-12-11 00:00:00.000000+0000 |      jsp@ua.pt |                                                               {8: 'Rest8'} | Joaquim | S. Pinto |    123456789
      ico | 2019-12-10 00:00:00.000000+0000 |      ico@ua.pt |                                                               {1: 'Rest1'} |  Ilidio | Oliveira |    123456789
    neves | 2019-12-05 00:00:00.000000+0000 |       an@ua.pt | {1: 'Rest1', 2: 'Rest2', 6: 'Rest6', 7: 'Rest7', 9: 'Rest9', 12: 'Rest12'} | António |    Neves |    123456789

(12 rows)
```

```
cqlsh:yelp> update type_foods set rests = {2, 8}, n_of_rest = 2 where type_of_food = 'american';
cqlsh:yelp> update type_foods set rests = {}, n_of_rest = 0 where type_of_food = 'chinese';
cqlsh:yelp> select * from type_foods ;

 type_of_food | n_of_rest | rests
--------------+-----------+-------------------------------
     american |         2 |                        {2, 8}
       french |         3 |                     {5, 7, 8}
      italian |         4 |                  {2, 4, 6, 7}
      chinese |         0 |                          null
   portuguese |         9 | {1, 2, 5, 6, 7, 8, 9, 11, 12}

(5 rows)
```